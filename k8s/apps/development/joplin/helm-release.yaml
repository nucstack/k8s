---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: joplin
  namespace: development
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: joplin-server
      version: 5.1.2
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  values:
    image:
      repository: joplin/server
      tag: 2.1.2
    env:
      TZ: UTC
      APP_BASE_URL: "https://joplin.${SECRET_DOMAIN}"
      APP_PORT: 22300
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      # -- Use pg for postgres
      # DB_CLIENT:  # pg
      # # -- Postgres DB Host
      # POSTGRES_HOST:  # joplin-postgresql
      # # -- Postgres DB port
      # POSTGRES_PORT:  # 5432
      # # -- Postgres DB name
      # POSTGRES_DATABASE:  # joplin
      # # -- Postgres DB Username
      # POSTGRES_USER:  # joplin
      # # -- Postgres DB password
      # POSTGRES_PASSWORD:  # joplin-pass
