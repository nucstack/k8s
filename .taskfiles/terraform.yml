---
version: '3'

env:
  TF_IN_AUTOMATION: true
  TF_WORKSPACE: "{{.ENVIRONMENT}}"

tasks:
  init:
    desc: Initialize terraform
    dir: "{{.TERRAFORM_DIR}}"
    cmds:      
      - terraform init -upgrade
    silent: true
  plan:
    desc: plan terraform
    env:
      TF_CLI_ARGS: -input=false
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform plan --var-file {{.ENVIRONMENT}}.auto.tfvars
  apply:
    desc: apply terraform
    env:
      TF_CLI_ARGS: -input=false
    dir: "{{.TERRAFORM_DIR}}"
    cmds:      
      - terraform apply --var-file {{.ENVIRONMENT}}.auto.tfvars
  destroy:
    desc: destroy terraform
    env:
      TF_CLI_ARGS: -input=false
    dir: "{{.TERRAFORM_DIR}}"
    cmds:      
      - terraform destroy --var-file {{.ENVIRONMENT}}.auto.tfvars
