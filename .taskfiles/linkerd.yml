---
version: '3'

tasks:

  generate-certs:
    desc: generate linkerd certs
    cmds:
      - step certificate create identity.linkerd.cluster.local /tmp/linkerd-ca.crt /tmp/linkerd-ca.key --profile root-ca --no-password --insecure --san identity.linkerd.cluster.local -f
      - step certificate create identity.linkerd.cluster.local /tmp/linkerd-issuer.crt /tmp/linkerd-issuer.key --ca /tmp/linkerd-ca.crt --ca-key /tmp/linkerd-ca.key --profile intermediate-ca --not-after 8760h --no-password --insecure --san identity.linkerd.cluster.local -f
      - kubectl -n linkerd create secret generic linkerd-certs --from-file=/tmp/linkerd-ca.crt --from-file=/tmp/linkerd-issuer.crt --from-file=/tmp/linkerd-issuer.key -o yaml --dry-run=client > linkerd-certs.yaml
    silent: true